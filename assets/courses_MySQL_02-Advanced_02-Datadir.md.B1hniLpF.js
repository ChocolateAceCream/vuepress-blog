import{_ as p}from"./chunks/ArticleMetadata.D7tUFrGb.js";import{_ as c,m as s,a as g,e as r,x as i,u as n,B as k,ah as m,o as l,p as y,q as u}from"./chunks/framework.BuAcqOzq.js";import"./chunks/theme.DY_CAYZ_.js";const f="/vuepress-blog/assets/extent.DuprZ1xJ.png",b="/vuepress-blog/assets/XDES.DpfuLevS.png",_="/vuepress-blog/assets/List_Base_Node.BHEK9M7t.png",M=JSON.parse('{"title":"Datadir","description":"","frontmatter":{"title":"Datadir","author":"ChocolateAceCream","date":"2024/02/17 10:24","isTop":true,"categories":["MySQL"],"tags":["MySQL"]},"headers":[],"relativePath":"courses/MySQL/02-Advanced/02-Datadir.md","filePath":"courses/MySQL/02-Advanced/02-Datadir.md","lastUpdated":1714762338000}'),x={name:"courses/MySQL/02-Advanced/02-Datadir.md"},A={id:"datadir",tabindex:"-1"},F=r("a",{class:"header-anchor",href:"#datadir","aria-label":'Permalink to "Datadir <Badge text="MySQL" type="warning" />"'},"​",-1),E=m('<h5 id="check-where-datadir-is" tabindex="-1">check where datadir is <a class="header-anchor" href="#check-where-datadir-is" aria-label="Permalink to &quot;check where datadir is&quot;">​</a></h5><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">show variables </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">like</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;datadir&#39;</span></span></code></pre></div><p>Once a new database is created, a folder named by that database is created under datadir. And in that new created folder, a dp.opt file is created to store the info of that db.</p><h3 id="table-space" tabindex="-1">table space <a class="header-anchor" href="#table-space" aria-label="Permalink to &quot;table space&quot;">​</a></h3><p>Then inside each db folder, each table have a table_name.ibd file, which stored maximum 2^32 pages. Since each page is 16kb, so a table space can hold maximum 64TB size of data</p><h3 id="extent" tabindex="-1">extent <a class="header-anchor" href="#extent" aria-label="Permalink to &quot;extent&quot;">​</a></h3><p>Since a table space can hold too many pages, mysql introduced a concept called extent, which is 64 consecutive pages. with each page takes 16kb, an extent occupied 1MB space. Every 256 extent can be grouped together</p><p><img src="'+f+'" alt="extent"></p><p>The reason for using extent is to eliminate random I/O in range search. If pages that stored the min and max value are physically far away rom each other, loading the in-between pages may require random I/O scan over disk space. So we introduce the concept of extent, which can store up to 64 consecutive pages to eliminate random I/O.</p><h3 id="segment-and-fragment" tabindex="-1">Segment and Fragment <a class="header-anchor" href="#segment-and-fragment" aria-label="Permalink to &quot;Segment and Fragment&quot;">​</a></h3><p>Each index will create two segment, one to store the leaf nodes(those with actual data) and one to store other nodes.</p><p>However, when a table with only a few records, each of its indexes will create minimum 2 segment, which takes 2MB space. It&#39;s a waste of space so mysql introduce the concept of fragment.</p><p>Fragment is a special extent that can contain pages from different segment. Fragment is directly belongs to table space, when data initially come into the table, mysql assign storage space page by page from fragment. Once a segment contains 32 fragment pages was, mysql start assign storage space extent by extent.</p><h5 id="type-of-extent" tabindex="-1">Type of extent <a class="header-anchor" href="#type-of-extent" aria-label="Permalink to &quot;Type of extent&quot;">​</a></h5><table><thead><tr><th style="text-align:left;">State</th><th style="text-align:left;">Meaning</th></tr></thead><tbody><tr><td style="text-align:left;">FREE</td><td style="text-align:left;">Free extent</td></tr><tr><td style="text-align:left;">FREE_FRAG</td><td style="text-align:left;">Fragment with free space</td></tr><tr><td style="text-align:left;">FULL_FRAG</td><td style="text-align:left;">full Fragment</td></tr><tr><td style="text-align:left;">FSEG</td><td style="text-align:left;">extent belongs to certain segment</td></tr></tbody></table><p><em><strong>p.s.</strong></em> Extent has status of FREE, FREE_FRAG and FULL_FRAG belongs to the table space directly, and FSEG belongs to certain segment</p><h5 id="xdes" tabindex="-1">XDES <a class="header-anchor" href="#xdes" aria-label="Permalink to &quot;XDES&quot;">​</a></h5><p>Extent Descriptor Entry: store info of extent for better management. <img src="'+b+`" alt="XDES"></p><p>We can form three linked lists using info provided from XDES.</p><ul><li>extents with status FREE</li><li>extents with status FREE_FRAG</li><li>extents with status FULL_FRAG</li></ul><p>Example: for the following table</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">create</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> table</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> t</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  c1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> not null</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> auto_increment,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  c2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">varchar</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  c3 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">varchar</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  primary key</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (c1),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> idx_c2(c2)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) engine</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">InnoDB;</span></span></code></pre></div><p>table t has two index, which turns to 4 segments. Each segment will create three linked lists: FREE, FREE_FRAG and FULL_FRAG.</p><p>In order to better describe these linked list, mysql introduced a structure called List Base Node</p><p><img src="`+_+'" alt="List_Base_Node"></p>',25);function D(e,w,C,B,v,S){const o=s("Badge"),h=p,d=s("ClientOnly");return l(),g("div",null,[r("h1",A,[i("Datadir "),n(o,{text:"MySQL",type:"warning"}),i(),F]),n(d,null,{default:k(()=>{var t,a;return[(((t=e.$frontmatter)==null?void 0:t.aside)??!0)&&(((a=e.$frontmatter)==null?void 0:a.showArticleMetadata)??!0)?(l(),y(h,{key:0,article:e.$frontmatter},null,8,["article"])):u("",!0)]}),_:1}),E])}const T=c(x,[["render",D]]);export{M as __pageData,T as default};
