import{_ as d}from"./chunks/ArticleMetadata.DfKT0g4_.js";import{_ as k,m as e,a as c,e as l,x as t,u as n,B as g,ah as u,o as p,p as m,q as y}from"./chunks/framework.BuAcqOzq.js";import"./chunks/theme.Da1o2_mT.js";const _="/vuepress-blog/assets/1.9qLgUvkf.png",F="/vuepress-blog/assets/2.CRL3BXQC.png",b="/vuepress-blog/assets/3.BWgjw0-x.png",v="/vuepress-blog/assets/4.CJefogNO.png",I=JSON.parse('{"title":"NPS Intranet Penetration","description":"","frontmatter":{"title":"NPS Intranet Penetration","author":"ChocolateAceCream","date":"2023/03/28 19:00","isTop":false,"categories":["IoT"],"tags":["NPS","Intranet Penetration"]},"headers":[],"relativePath":"categories/IoT/2023/04/15/nps_intranet_penetration.md","filePath":"categories/IoT/2023/04/15/nps_intranet_penetration.md","lastUpdated":1714716219000}'),D={name:"categories/IoT/2023/04/15/nps_intranet_penetration.md"},A={id:"nps-usage",tabindex:"-1"},C=l("a",{class:"header-anchor",href:"#nps-usage","aria-label":'Permalink to "NPS Usage <Badge text="NPS" type="warning" />"'},"​",-1),f=u(`<h3 id="purpose" tabindex="-1">Purpose: <a class="header-anchor" href="#purpose" aria-label="Permalink to &quot;Purpose:&quot;">​</a></h3><p>Use server&#39;s public ip and domain to forward request to services running on home PC.</p><p><em><strong>e.g.</strong></em> visit photoprism service that running on local raspberry pi using cloud server ip+port or domain+port.</p><h3 id="approach" tabindex="-1">Approach: <a class="header-anchor" href="#approach" aria-label="Permalink to &quot;Approach:&quot;">​</a></h3><p>install nps client and server on target hosts to build a trunnel for intranet penetration</p><hr><h4 id="server-side" tabindex="-1">server side <a class="header-anchor" href="#server-side" aria-label="Permalink to &quot;server side&quot;">​</a></h4><ol><li><p>download nps server install pkg from <a><a href="https://github.com/ehang-io/nps/releases" target="_blank" rel="noreferrer">https://github.com/ehang-io/nps/releases</a></a></p></li><li><p>unzip pkg and run install script</p></li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -zxvf</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> linux_amd64_server.tar.gz</span></span></code></pre></div><ol start="3"><li>edit config file in /etc/nps/conf</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># /etc/nps/conf/nps.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#HTTP(S) proxy port, no startup if empty</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">http_proxy_port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">20080</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # so nps won&#39;t block normal 80 &amp; 443 port</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">https_proxy_port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">20443</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">##bridge</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">bridge_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">tcp</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">bridge_port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">8024</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">bridge_ip</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">0.0.0.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#web</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">web_username</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">admin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">web_password</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">123qwe</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">web_port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">8080</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # port of web admin portal</span></span></code></pre></div><ol start="4"><li>start nps</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ./nps</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> start</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> 2&gt;&amp;1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> &amp;</span></span></code></pre></div><ol start="5"><li><p>login web portal, add a client <img src="`+_+'" alt="图片alt" title="图片title"></p></li><li><p>add a tcp tunnel, so client_ip:target_port will be mapped to server_ip:server_port <img src="'+F+'" alt="图片alt" title="图片title"></p></li><li><p>if you have a domain that you want to build a tunnel on domain:port instead of server_up:port, you can add a Host <img src="'+b+'" alt="图片alt" title="图片title"></p></li></ol><p><em><strong>p.s.</strong></em> remember to open port 8080 (web portal), 8024 (bridge port), in your cloud server, 21005 (tcp tunnel port) on server side and 2342 (client service running port) on client side</p><hr><h4 id="client-side" tabindex="-1">client side <a class="header-anchor" href="#client-side" aria-label="Permalink to &quot;client side&quot;">​</a></h4><ol><li><p>download nps client pkg and unzip pkg, similarly to the server side</p></li><li><p>start nps client</p></li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ./npc</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -server=server_ip:8024</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -vkey=unique_verify_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> 2&gt;&amp;1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> &amp;</span></span></code></pre></div><img src="'+v+'" alt="图片alt" title="图片title"><h3 id="done" tabindex="-1">Done <a class="header-anchor" href="#done" aria-label="Permalink to &quot;Done&quot;">​</a></h3><p>now you can visit home service with your domain:ip</p>',22);function P(s,B,w,x,q,N){const r=e("Badge"),o=d,h=e("ClientOnly");return p(),c("div",null,[l("h1",A,[t("NPS Usage "),n(r,{text:"NPS",type:"warning"}),t(),C]),n(h,null,{default:g(()=>{var i,a;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((a=s.$frontmatter)==null?void 0:a.showArticleMetadata)??!0)?(p(),m(o,{key:0,article:s.$frontmatter},null,8,["article"])):y("",!0)]}),_:1}),f])}const V=k(D,[["render",P]]);export{I as __pageData,V as default};
