import{_ as o}from"./chunks/ArticleMetadata.BYdHG1cA.js";import{_ as d,m as e,a as c,e as p,x as n,u as t,B as g,ah as y,o as l,p as A,q as C}from"./chunks/framework.BuAcqOzq.js";import"./chunks/theme.CWah8N01.js";const I=JSON.parse('{"title":"Pinia Partial Subscribe","description":"","frontmatter":{"title":"Pinia Partial Subscribe","author":"ChocolateAceCream","date":"2023/08/22 19:00","isTop":false,"categories":["frontend"],"tags":["Pinia","Vue3"]},"headers":[],"relativePath":"categories/frontend/2023/08/22/pinia_partial_subscribe.md","filePath":"categories/frontend/2023/08/22/pinia_partial_subscribe.md","lastUpdated":1714672867000}'),u={name:"categories/frontend/2023/08/22/pinia_partial_subscribe.md"},D={id:"pinia-partial-subscribe",tabindex:"-1"},B=p("a",{class:"header-anchor",href:"#pinia-partial-subscribe","aria-label":'Permalink to "Pinia Partial Subscribe <Badge text="Pinia" type="warning" />"'},"​",-1),m=y(`<h3 id="problem" tabindex="-1">Problem <a class="header-anchor" href="#problem" aria-label="Permalink to &quot;Problem&quot;">​</a></h3><p>In my App.vue entry file, I subscribed to the pinia store, capture the change of locale and then reload my app to apply the change. However, when I use store.$subscribe(), it actually watch the whole store state. Any change to any field of store state will trigger the reload() function and cause problems.</p><p>e.g. old subscribe function in App.vue</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> useSessionStore</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">store.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">$subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  state.locale </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> elementPlusLocaleMapper[s.userInfo.locale]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  locale.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> s.userInfo.locale</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  dayjs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">locale</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(dayjsLocaleMapper[s.userInfo.locale])</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">  reload</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">})</span></span></code></pre></div><p>if any component make change to any field of store state, reload() is triggered. e.g.</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">onBeforeUnmount</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> useSessionStore</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">clearInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(state.autoSave)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  store.currentEditingArticle </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">})</span></span></code></pre></div><h3 id="solution" tabindex="-1">Solution <a class="header-anchor" href="#solution" aria-label="Permalink to &quot;Solution&quot;">​</a></h3><p>I have to modify the original code so that I only watch to the store.userInfo.locale property</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">watch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> store.userInfo.locale,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  (</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">newValue</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">_</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    state.locale </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> elementPlusLocaleMapper[newValue]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    locale.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> newValue</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    dayjs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">locale</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(dayjsLocaleMapper[newValue])</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    reload</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>Now the app will only reload() when any change made to store.userInfo.locale property.</p>`,10);function b(s,_,E,F,f,v){const h=e("Badge"),r=o,k=e("ClientOnly");return l(),c("div",null,[p("h1",D,[n("Pinia Partial Subscribe "),t(h,{text:"Pinia",type:"warning"}),n(),B]),t(k,null,{default:g(()=>{var i,a;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((a=s.$frontmatter)==null?void 0:a.showArticleMetadata)??!0)?(l(),A(r,{key:0,article:s.$frontmatter},null,8,["article"])):C("",!0)]}),_:1}),m])}const V=d(u,[["render",b]]);export{I as __pageData,V as default};
