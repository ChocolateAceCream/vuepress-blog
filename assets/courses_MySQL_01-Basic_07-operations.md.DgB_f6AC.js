import{_ as e}from"./chunks/ArticleMetadata.BbqknxEy.js";import{_ as p,m as k,a as d,u as r,B as o,e as t,x as g,ah as y,o as n,p as A,q as c}from"./chunks/framework.BuAcqOzq.js";import"./chunks/theme.ClFlnpYU.js";const q=JSON.parse('{"title":"MySQL operations","description":"","frontmatter":{"title":"MySQL operations","author":"ChocolateAceCream","date":"2024/02/24 10:24","isTop":true,"categories":["MySQL"],"tags":["MySQL"]},"headers":[],"relativePath":"courses/MySQL/01-Basic/07-operations.md","filePath":"courses/MySQL/01-Basic/07-operations.md","lastUpdated":1714766746000}'),C={name:"courses/MySQL/01-Basic/07-operations.md"},u=t("h1",{id:"mysql-operations",tabindex:"-1"},[g("MySQL operations "),t("a",{class:"header-anchor",href:"#mysql-operations","aria-label":'Permalink to "MySQL operations"'},"â€‹")],-1),D=y(`<ol><li>select different columns from different tables:</li></ol><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">ID</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">Name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">Street</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">City</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> person </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> a</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">left join</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> loc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> b</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">on</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">ID</span></span></code></pre></div><ol start="2"><li>limit and offset</li></ol><ul><li>limit 1,n means to retrieve &quot;n&quot; number of rows starting from the second(1+1) row.</li><li>limit 1 offset n means to skip the first &quot;N&quot; number of rows and retrieve only one row after that</li><li>limit and offset applies to the query result e.g.</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">SELECT</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(author_id) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> total </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> articles </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">ORDER BY</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">DESC</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> LIMIT</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- this won&#39;t sum up first 4 rows, the query will first sum up all rows then apply limit 4 on the result, so the final result if null</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- optionally, you can use where to select first 4 rows.</span></span></code></pre></div><ol start="3"><li>DENSE_RANK(), rank() and row_number()</li></ol><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">	published,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">	title,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">	DENSE_RANK</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">over</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ( </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">PARTITION</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> BY</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> published </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">ORDER BY</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> id ) </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`rank\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">FROM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">	articles</span></span></code></pre></div><table><thead><tr><th>published</th><th>title</th><th>rank</th></tr></thead><tbody><tr><td>1</td><td>Hello World</td><td>1</td></tr><tr><td>1</td><td>fdasf</td><td>2</td></tr><tr><td>1</td><td>Project deployment through multiple nginx container</td><td>3</td></tr><tr><td>1</td><td>ssh to remote server using ssh config</td><td>4</td></tr><tr><td>1</td><td>Config github action for CI/CD</td><td>5</td></tr><tr><td>1</td><td>Golang Embed usage (need go1.16+)</td><td>6</td></tr><tr><td>1</td><td>Deploy minio using docker to provide image hosting service</td><td>7</td></tr><tr><td>1</td><td>Fetch text file from backend and then display</td><td>8</td></tr><tr><td>1</td><td>Gorm raw sql pagination</td><td>9</td></tr><tr><td>1</td><td>Gorm UpdateColumn</td><td>10</td></tr><tr><td>1</td><td>Integrate emoji-mart-vue-fast in elementPlus</td><td>11</td></tr><tr><td>1</td><td>Watch pinia store object field change in vue3</td><td>12</td></tr><tr><td>1</td><td>Gorm cascade delete</td><td>13</td></tr><tr><td>1</td><td>Install bypass openwrt in docker</td><td>14</td></tr><tr><td>1</td><td>Mount ext4 harddisk to openwrt in docker</td><td>15</td></tr><tr><td>1</td><td>Portainer tls connect to remote env</td><td>16</td></tr><tr><td>1</td><td>Set swap memory in Linux</td><td>17</td></tr><tr><td>1</td><td>NPS</td><td>18</td></tr><tr><td>1</td><td>Install docker-compose on Raspberry Pi 3B</td><td>19</td></tr><tr><td>1</td><td>Setting dayjs i18n in vue3</td><td>20</td></tr><tr><td>1</td><td>gorm association preload usage</td><td>21</td></tr><tr><td>1</td><td>Build a notification system</td><td>22</td></tr><tr><td>1</td><td>asdfasdf</td><td>23</td></tr><tr><td>2</td><td></td><td>1</td></tr><tr><td>2</td><td></td><td>2</td></tr><tr><td>2</td><td></td><td>3</td></tr><tr><td>2</td><td></td><td>4</td></tr><tr><td>2</td><td></td><td>5</td></tr></tbody></table><p>As shown in the result, <strong>DENSE_RANK()</strong> will create an additional colum as rank (be careful to use <code>rank</code> since rank keyword is preserved by mysql, otherwise you can use my_rank or xxx directly as column name). The PARTITION BY create a published value.</p><p>same syntax applied for rank() and row_number(), the only difference is the result:</p><ul><li>row_number() will never repeat, just rank from 1,2,3,4,5 etc...</li><li>rank() can repeat, if a&gt;b=c&gt;d, then a=1, b=2, c=2, d= 4</li><li>dense_rank() also repeat, if a&gt;b=c&gt;d, then a=1, b=2,c=2,d=3</li></ul><ol start="4"><li>having</li></ol><ul><li>usually used with <strong>group by</strong> keywords, to filter out groups which meet the certain conditions</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">SELECT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">	pid,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">	SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">( pid ) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> total,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">	count</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">( pid )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">FROM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">	menus </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> a</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">GROUP BY</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">	pid</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">HAVING</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">	total </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6</span></span></code></pre></div><ol start="5"><li>date operation</li></ol><ul><li>convert a datetime type colum to date type column, so you can compare the two datetime column by their date only</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">DATE</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(datetime_type_colum_name)</span></span></code></pre></div><ul><li>add/sub duration to a date</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">DATE_SUB(date_column, INTERVAL </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">12</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> DAY</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">DATE_ADD(date_column, INTERVAL </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> YEAR</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><ul><li>the diff between two date</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"># </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> date_col_1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">is</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> day</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> earlier than date_col_2</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">DATEDIFF</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(date_col_1, date_col_2) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> # true</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">DATEDIFF</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">( date_col_2,date_col_1) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> # true</span></span></code></pre></div><ul><li>using data range in where closure</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> my_date </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">between</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;2013-10-01&#39;</span></span></code></pre></div><ol start="6"><li>math operations</li></ol><ul><li>round(val, decimal_points) round a number to designated decimal points</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">round</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">123123</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- output 2.12</span></span></code></pre></div><ul><li>using sum with if</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">sum</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;completed&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- if status is completed, then sum += 0, else, sum += 1</span></span></code></pre></div><ul><li>using sum with case when</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">sum</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">case</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> when</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;completed&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> then</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> else</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> end</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><ul><li>with used to define common table expressions (CTEs). CTEs are temporary result sets that can be referenced within the main query</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">With</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  select distinct</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> player_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> pi, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">min</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(event_date) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> e</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  from</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> activity</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  group by</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> player_id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  select</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> *</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  from</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> Activity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> a1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  join</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  on</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> a1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">player_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> t1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">pi</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> DATE_ADD(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">t1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, interval </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> day</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> a1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">event_date</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> round</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">((</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> count</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t2) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> count</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t1) , </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> fraction</span></span></code></pre></div><ul><li>using count(*) over</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">with</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> tiv_2016,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">OVER</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">PARTITION</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> BY</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (tiv_2015)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> cnt_2015,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">COUNT</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">OVER</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">PARTITION</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> BY</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> lat, lon) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> cnt_ll</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> Insurance)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> round</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">sum</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(tiv_2016),</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> tiv_2016  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> cnt_2015 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> cnt_ll </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span></span></code></pre></div><p>explain: <strong>COUNT(*)</strong> is a window function that counts the number of rows in each partition of the result set. <strong>OVER</strong> is a keyword that indicates that we are using a window function and specifies the window or partition of the result set to operate on. <strong>PARTITION BY (tiv_2015)</strong> is a clause that defines the partitioning scheme for the window function. In this case, we are partitioning the result set by the tiv_2015 column, which means that the window function will count the number of rows with the same tiv_2015 value.</p><ol start="7"><li>ROW_NUMBER() OVER (partition by xxx order by id) generate unique number for each row in the result set</li></ol><ul><li>PARTITION BY (optional): Divides the result set into partitions based on one or more columns. The ROW_NUMBER() function restarts the numbering for each partition.</li><li>ORDER BY (optional): Specifies the order of the rows within each partition. The</li></ul><p><em><strong>PS:</strong></em> note that the ROW_NUMBER() function does not guarantee any specific order unless an ORDER BY clause is specified. e.g.</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> id,visit_date,people, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">ROW_NUMBER</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">over</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">order by</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> id) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> rn</span></span></code></pre></div><ol start="8"><li>group by VS. distinct in terms of efficiency, if there&#39;s index, then almost the same.</li></ol><p>before mysql 8.0: group by sorted implicitly under certain condition (that&#39;s why we usually use <em><strong>order by null</strong></em> to suppress this action). therefore if no index present, distinct has better efficiency</p><p>mysql 9.0 and above: implicitly sort has been removed, so almost the same even without index.</p>`,42);function F(s,B,m,E,b,v){const l=e,h=k("ClientOnly");return n(),d("div",null,[u,r(h,null,{default:o(()=>{var i,a;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((a=s.$frontmatter)==null?void 0:a.showArticleMetadata)??!0)?(n(),A(l,{key:0,article:s.$frontmatter},null,8,["article"])):c("",!0)]}),_:1}),D])}const T=p(C,[["render",F]]);export{q as __pageData,T as default};
