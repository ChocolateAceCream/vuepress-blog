import{_ as r}from"./chunks/ArticleMetadata.C2LaQr-N.js";import{_ as o,m as a,a as g,e as h,x as e,u as l,B as y,ah as c,o as n,p as A,q as C}from"./chunks/framework.BuAcqOzq.js";import"./chunks/theme.QIVrTItc.js";const f="/vuepress-blog/assets/join_buffer.DEypxuuc.png",S=JSON.parse('{"title":"How join works","description":"","frontmatter":{"title":"How join works","author":"ChocolateAceCream","date":"2024/02/15 10:24","isTop":true,"categories":["MySQL"],"tags":["MySQL"]},"headers":[],"relativePath":"courses/MySQL/01-Basic/03-How_join_works.md","filePath":"courses/MySQL/01-Basic/03-How_join_works.md","lastUpdated":1714762338000}'),F={name:"courses/MySQL/01-Basic/03-How_join_works.md"},m={id:"how-join-works",tabindex:"-1"},D=h("a",{class:"header-anchor",href:"#how-join-works","aria-label":'Permalink to "How join works <Badge text="MySQL" type="warning" />"'},"â€‹",-1),u=c(`<p>example tables:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> t1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">	m1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INT</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">n1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">CHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ( </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> t2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">	m2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INT</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">n2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">CHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ( </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">VALUES</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">	( </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;a&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">	( </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;b&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">	( </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;c&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> );</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">VALUES</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">	( </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;b&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">	( </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;c&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">	( </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;d&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> );</span></span></code></pre></div><p>if we execute</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">select</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t1, t2</span></span></code></pre></div><p>the result is Cartesian product of t1 X t2</p><table><thead><tr><th style="text-align:left;">m1</th><th style="text-align:left;">n1</th><th style="text-align:left;">m2</th><th style="text-align:left;">n2</th></tr></thead><tbody><tr><td style="text-align:left;">3</td><td style="text-align:left;">c</td><td style="text-align:left;">2</td><td style="text-align:left;">b</td></tr><tr><td style="text-align:left;">2</td><td style="text-align:left;">b</td><td style="text-align:left;">2</td><td style="text-align:left;">b</td></tr><tr><td style="text-align:left;">1</td><td style="text-align:left;">a</td><td style="text-align:left;">2</td><td style="text-align:left;">b</td></tr><tr><td style="text-align:left;">3</td><td style="text-align:left;">c</td><td style="text-align:left;">3</td><td style="text-align:left;">c</td></tr><tr><td style="text-align:left;">2</td><td style="text-align:left;">b</td><td style="text-align:left;">3</td><td style="text-align:left;">c</td></tr><tr><td style="text-align:left;">1</td><td style="text-align:left;">a</td><td style="text-align:left;">3</td><td style="text-align:left;">c</td></tr><tr><td style="text-align:left;">3</td><td style="text-align:left;">c</td><td style="text-align:left;">4</td><td style="text-align:left;">d</td></tr><tr><td style="text-align:left;">2</td><td style="text-align:left;">b</td><td style="text-align:left;">4</td><td style="text-align:left;">d</td></tr><tr><td style="text-align:left;">1</td><td style="text-align:left;">a</td><td style="text-align:left;">4</td><td style="text-align:left;">d</td></tr></tbody></table><p>example 2:</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">select</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t1, t2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">where</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> t1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">m1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> and</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> t1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">m1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> t2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">m2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> and</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> t2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">n2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;d&#39;</span></span></code></pre></div><p>execute process:</p><ol><li>using all operation to select t1.m1 &gt; 1 rows from t1. in this case, which are m1 = 2 and m1 = 3 two rows</li><li>use the result from step 1, convert t1.m1 = t2.m2 to t2.m2 = 2 and t1.m1 = t2.m2 to t2.m2 = 3 two searches. combine with t2.n2 &lt; &#39;d&#39;, we can lookup result using single table t2. So we totally visit t1 once and t2 twice.</li></ol><p>However, if matched result from step 1 is n, we might need to visit t2 n times.</p><h3 id="type-of-join" tabindex="-1">Type of join <a class="header-anchor" href="#type-of-join" aria-label="Permalink to &quot;Type of join&quot;">â€‹</a></h3><ul><li>inner join : where and on have same effect equivalent expression of inner join:</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">JOIN</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t2;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INNER JOIN</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t2;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">CROSS JOIN</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t2;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> t1, t2;</span></span></code></pre></div><ul><li>outer join <ul><li>left join: left table is the driver table</li><li>right join: right table is the driver table</li></ul></li></ul><p>where will effect on both tables. on: for outer join, if the Driven table cannot find records matching on condition, then its column will be filled with null.</p><h3 id="not-using-select" tabindex="-1">Not using select * <a class="header-anchor" href="#not-using-select" aria-label="Permalink to &quot;Not using select *&quot;">â€‹</a></h3><p>because some columns is not indexed, so when searching the driven table, we can only do whole table scan.</p><h3 id="block-nested-loop-join" tabindex="-1">Block Nested-Loop Join <a class="header-anchor" href="#block-nested-loop-join" aria-label="Permalink to &quot;Block Nested-Loop Join&quot;">â€‹</a></h3><p>Since the driven talbe may be visited n times, each time sql have to load data from disk into memory and then do the scan and compare in memory. Once n become large, I/O cost would be huge, so we use Block Nested-Loop Join to reduce the visit time of driven table.</p><p>The approach is like the following: After get a result set from driver table, we load them into a join buffer. Then we load one row from driven table, compare to each of data stored in join buffer. If join buffer is big enough to hold all the result set from driver table, we only need to scan driven table once. <img src="`+f+'" alt="join_buffer"></p><p>The default size of join buffer is 256kb and minimum you can set is 128bytes.</p><p><em><strong>P.S.</strong></em> since the columns that put into join buffer is the ones from select, so better avoid using * to save space.</p>',23);function B(s,b,E,x,w,_){const p=a("Badge"),k=r,d=a("ClientOnly");return n(),g("div",null,[h("h1",m,[e("How join works "),l(p,{text:"MySQL",type:"warning"}),e(),D]),l(d,null,{default:y(()=>{var i,t;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((t=s.$frontmatter)==null?void 0:t.showArticleMetadata)??!0)?(n(),A(k,{key:0,article:s.$frontmatter},null,8,["article"])):C("",!0)]}),_:1}),u])}const N=o(F,[["render",B]]);export{S as __pageData,N as default};
