import{_ as r}from"./chunks/ArticleMetadata.DfKT0g4_.js";import{_ as p,m as o,a as h,u as k,B as c,e as a,x as g,ah as d,o as n,p as u,q as y}from"./chunks/framework.BuAcqOzq.js";import"./chunks/theme.Da1o2_mT.js";const E=JSON.parse('{"title":"Ingress Intro","description":"","frontmatter":{"title":"Ingress Intro","author":"ChocolateAceCream","date":"2024/04/11 19:00","isTop":false,"categories":["DevOps"],"tags":["Ingress","Kubernetes"]},"headers":[],"relativePath":"categories/DevOps/2024/04/11/Ingress.md","filePath":"categories/DevOps/2024/04/11/Ingress.md","lastUpdated":1714766746000}'),D={name:"categories/DevOps/2024/04/11/Ingress.md"},m=a("h1",{id:"ingress",tabindex:"-1"},[g("Ingress "),a("a",{class:"header-anchor",href:"#ingress","aria-label":'Permalink to "Ingress"'},"​")],-1),A=d(`<h4 id="intro" tabindex="-1">Intro <a class="header-anchor" href="#intro" aria-label="Permalink to &quot;Intro&quot;">​</a></h4><p>ingress is used to manage the external access to the services inside a k8s clusters.</p><p>In order to use ingress, you have to first create an ingress controller, then define your own routing rules to direct traffics.</p><p>e.g. create an ingress proxy to direct traffic to local k8s cluster service running in docker desktop</p><ol><li>install ingress controller. so controller will automatically detect rules and apply those rules to proxy request</li></ol><blockquote><p>helm repo add ingress-nginx <a href="https://kubernetes.github.io/ingress-nginx" target="_blank" rel="noreferrer">https://kubernetes.github.io/ingress-nginx</a> helm repo update <br> helm upgrade --install ingress-nginx ingress-nginx <br> --repo <a href="https://kubernetes.github.io/ingress-nginx" target="_blank" rel="noreferrer">https://kubernetes.github.io/ingress-nginx</a> <br> --namespace ingress-nginx --create-namespace</p></blockquote><p>this will install ingress under ingress-nginx namespace, if that namespace is not exists, it will create one automatically</p><ol start="3"><li>check if ingress controller is running</li></ol><blockquote><p>kubectl get service -n ingress-nginx</p></blockquote><p>you can check the log for the controller from pod like this:</p><blockquote><p>kubectl get pod -n ingress-nginx</p></blockquote><p>to get a list of pods, copy the pod name for controller, then run this</p><blockquote><p>kubectl logs -n ingress-nginx &lt;pod_name&gt;</p></blockquote><ol start="4"><li>apply routing rules</li></ol><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># consul-ingress.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Ingress</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">consul-ui-ingress</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">consul</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  ingressClassName</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">nginx</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  rules</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;consul-ui&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    http</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      paths</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">pathType</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Prefix</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        path</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;/&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        backend</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">          service</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">consul-ui</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            port</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">              number</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">80</span></span></code></pre></div><p>several things to notice here:</p><ul><li>this ingress service has to be under the same namespace of the service endpoint you want redirect your traffic to. In this case, it has to be under consul namespace, which is the same namespace of consul-ui service.</li><li>ingressClassName is a new concept in k8s 1.18+, to specify the class of Ingress Controllers that should handle the Ingress, depends on the ingress controller type installed on k8s cluster. to check which class in your case, run</li></ul><blockquote><p>kubectl get ingressclass</p></blockquote><ul><li>host can only be names but not ips. remember to add consul-ui to your hosts files.</li><li>ingress cannot forward host:ip, it can only listen to port 80 for http or 443 for https, so best practice is to add different host names in your hosts file. Ingress will redirect the request based on the host name of the request.</li></ul><p>Now apply this rules:</p><blockquote><p>kubectl apply -f consul-ingress.yml</p></blockquote><p>Now if you visit consul-ui, ingress will redirect that request to consul-ui service port 80</p><h3 id="other-approach" tabindex="-1">Other approach <a class="header-anchor" href="#other-approach" aria-label="Permalink to &quot;Other approach&quot;">​</a></h3><p>you can simply forward a port using</p><blockquote><p>kubectl port-forward service/consul-server --namespace consul 8500:8500</p></blockquote><p>to map that service port to localhost port 8500</p>`,26);function C(s,b,f,B,_,F){const t=r,l=o("ClientOnly");return n(),h("div",null,[m,k(l,null,{default:c(()=>{var i,e;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((e=s.$frontmatter)==null?void 0:e.showArticleMetadata)??!0)?(n(),u(t,{key:0,article:s.$frontmatter},null,8,["article"])):y("",!0)]}),_:1}),A])}const I=p(D,[["render",C]]);export{E as __pageData,I as default};
